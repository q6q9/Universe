#include <iostream>
#include <vector>
#include <stdarg.h>
#include <fstream>
#include <string>
#include <regex>
#include <algorithm>
#include <iterator>
#include <ctime>
#include <random>

#define d(a) a[0] << a[1] << "." << a[2] << a[3] << "." << a.substr(4, 4)
#define rand(x) engine() % x
#define ctoi(j) atoi(string({j[0]}).c_str())
using namespace std;

class Cinema;
class Film;
class Repertoire;

vector<Film> films;
vector<Cinema> cinemas;
vector<Repertoire> repertoires;

void to_lower(char *c)
{
    if (*c >= 'A' && *c <= 'Z')
    {
        *c = *c + 'a' - 'A';
    }
    if (*c >= 'А' && *c <= 'Я')
    {
        *c = *c + 'a' - 'A';
    }
}
string low(string s)
{
    for (size_t i = 0; i < s.size(); i++)
    {
        to_lower(&s[i]);
    }
    return s;
}
vector<string> low(vector<string> x)
{
    for (string &s : x)
        for (size_t i = 0; i < s.size(); i++)
            s[i] = tolower(s[i], locale("ru"));

    for (string &s : x)
        cout << s << endl;
    return x;
}
void reverseStr(string &str)
{
    int n = str.length();

    // Swap character starting from two
    // corners
    for (int i = 0; i < n / 2; i++)
        swap(str[i], str[n - i - 1]);
}
vector<string> e_parse(string str)
{
    int i = 0, j, y;
    string word;
    vector<string> a;
    while (i < str.size())
    {
        word = "";
        while (str[i] != ',' && i < str.size())
        {
            // cout << "1 " << str[i] << endl;
            word += str[i];
            i++;
        }
        j = 0;
        // cout << "1.5 " << word[j] << endl;
        if (word[j] == ' ')
        {
            for (j = 0; j < word.size(); j++)
            {
                // cout << "2 " << word[j] << endl;
                if (word[j] != ' ')
                {
                    j += word.size();
                }
            };
            // cout << "2.5 " << word[j] << endl;
            word = word.substr(j - word.size() - 1);
        }
        for (j = 0; j < word.size(); j++)
        {
            // cout << "3 " << word[j] << endl;
            if (word[j] == ' ')
            {
                break;
            }
        };
        for (y = j; y < word.size(); y++)
        {
            // cout << "4 " << word[y] << endl;
            if (word[y] != ' ')
            {
                break;
            }
        };
        word = word.substr(0, j + 1) + word.substr(y);

        reverseStr(word);
        j = 0;
        // cout << "3.5 " << word[j] << endl;
        if (word[j] == ' ')
        {
            for (j = 0; j < word.size(); j++)
            {
                // cout << "2 " << word[j] << endl;
                if (word[j] != ' ')
                {
                    j += word.size();
                }
            };
            // cout << "2.5 " << word[j] << endl;
            word = word.substr(j - word.size() - 1);
        }
        reverseStr(word);
        a.push_back(word);
        i++;
    }
    // for(string b:a)cout<<b<<endl;
    return a;
}
void get_films(vector<Film> &films);
void get_all(vector<Cinema> &cinemas, vector<Film> &films, vector<Repertoire> &repertoires);
string unvector(const vector<string> &a)
{
    string s;
    for (string const &b : a)
        s += b + ((b != a[a.size() - 1]) ? ", " : "");
    return s;
}
void print(string text) { cout << text << endl; } //вывод текста
void cls() { printf("\e[1;1H\e[2J"); }            //очистка консоли
void menu(int i, ...)                             //контекстное меню
{
    va_list t;
    va_start(t, i);
    print("Выберите действие:");
    for (size_t j = 0; j <= i; j++)
        printf("[%d] - %s\n", j, (j ? va_arg(t, char *) : "Вернуться (выход)"));
}
void cc() //очистка потока ввода
{
    cin.clear();
    cin.ignore(32767, '\n');
}
void cinx(int &x, string text, int i, ...) //ввод x
{

    print(text);
    va_list t;
    va_start(t, i);
    for (size_t j = 0; j <= i; j++)
        printf("[%d] - %s\n", j, (j ? va_arg(t, char *) : "Вернуться (выход)"));
    cin >> x;
    while (cin.fail() || (x < 0 || x > i))
    {
        cc();
        cout << "Неверное значение (введите цифру от 1 до " << i << ")" << endl;
        cin >> x;
    }
    cc();
    cls();
}
void cinx(int &x, string text)
{
    print(text);
    cin >> x;
    while (cin.fail())
    {
        cc();
        cout << "Неверное значение (введите число)" << endl;
        cin >> x;
    }
}
void cinx(string &x, string text, int i, ...) //ввод x
{

    print(text);
    va_list t;
    va_start(t, i);
    for (size_t j = 0; j <= i; j++)
        printf("[%d] - %s\n", j, (j ? va_arg(t, char *) : "Вернуться (выход)"));
    // getline(cin, x);

    // while ((ctoi(x) < 0) || (ctoi(x) > i) || (x[1] != ' '))
    // {

    //     cout << "Неверное значение (введите цифру от 1 до " << i << " и команду)" << endl;
    //     getline(cin, x);
    // }
    // cc();
    // cls();
}
void push_line(string &str) //ввод не пустых строк
{
    for (;;)
    {
        getline(cin, str);
        string a;
        for (size_t i = 0; i < str.size(); i++)
        {
            if (str[i] != ' ')
                a += str[i];
        }
        if (a == "")
            print("Err: empty line");
        else
            return;
    }
}
string str(vector<string> &b) //"<%s>",b[]
{
    string a = "<";
    for (string &x : b)
        a += "'" + x + "'";

    return a + ">";
}
string str(string &b) //"<%s>",b
{
    return "<" + b + ">";
}
void push_vector(vector<string> &a)
{
    string b;
    string x;
    for (;;)
    {
        // cout << "_" << b << "_" << endl;
        getline(cin, b);
        x = "";
        for (size_t i = 0; i < b.size(); i++)
        {
            if (b[i] != ' ')
                x += b[i];
        }

        // cout << "_" << b << "_" << endl;
        if (x == "")
        {
            print("Err: empty line");
            continue;
        }
        if (b == "-1" && a.size() > 0)
            break;
        a.push_back(b);
    }
}
void push_vector(vector<Repertoire *> &a)
{
    int x;
    for (;;)
    {
        // cout << "_" << b << "_" << endl;
        r_cin(x);
        Repertoire z(0);
        if (x != -1)
        {
            if (!z.search(x))
                a.push_back(z.search(x));
        }
        else
            return;
    }
}
vector<string> parsing(string &str, regex &reg)
{
    string s;
    vector<string> a;
    sregex_iterator currentMatch(str.begin(), str.end(), reg);
    sregex_iterator lastMatch;
    while (currentMatch != lastMatch)
    {
        s = "";
        smatch match = *currentMatch;
        for (size_t i = 0; i < match.str().size(); i++)
        {
            if (i < match.str().size() - 2)
                s += match.str()[i + 1];
        }
        a.push_back(s);
        currentMatch++;
    }
    return a;
}
void r_cin(int &j)
{
    for (;;)
    {
        cin >> j;
        if (cin.fail())
            cc();
        else
            break;
        print("Неверный ввод, попробуйте ввести число:");
    }
}

class Cinema
{
private:
    // int id, places, halls;
    // string name, address, category;
    // bool state;

public:
    //<id><places><halls><name><addres><category><state><reps[0] reps[n] >
    int id, places, halls;
    string name, address, category;
    bool state;
    vector<Repertoire *> reps;
    Cinema(int id, int places, int halls, string name,
           string address, string category, bool state, vector<Repertoire *> reps) : id(id), places(places), halls(halls), name(name),
                                                                                     address(address), category(category), state(state), reps(reps) {}
    Cinema(Cinema const &a) : Cinema(a.id, a.places, a.halls, a.name, a.address, a.category, a.state, a.reps) {}
    Cinema(int a) {}
    Cinema() { input(); }
    Cinema(string str)
    {
        regex reg("<.*?>");
        // sregex_iterator abc(str.begin(),
        //                     str.end(), reg);
        vector<string> a;
        vector<string> h;
        vector<Repertoire *> c;
        a = parsing(str, reg);
        int f;
        //<слово>
        for (size_t j; j < a.size(); j++)
        {
            a[j] = a[j].substr(1, a[j].size() - 2);
        }
        reg = ("\\d+");
        h = parsing(a[7], reg);
        Repertoire x(0);
        for (string &z : h)
        {
            f = stoi(z);
            if (!x.search(f))
            {
                c.push_back(x.search(f));
            } //ERRRR
        }

        // int d = stoi(a[1]);
        *this = Cinema(stoi(a[0]), stoi(a[1]), stoi(a[2]), a[3], a[4], a[5], (a[6] == "1"), c);
    }
    ~Cinema();

    void set_id()
    {
        id = 1;
        bool z = false;
        // vector<Film> films;
        // get_films(films);
        // vector<int> ids(films.size());
        for (;;)
        {
            z = false;
            for (Cinema const &a : cinemas)
                if (id == a.id)
                {
                    z = true;
                    id++;
                    continue;
                }
            if (!z)
                return;
        }
    }
    void input()
    {
        int i;
        vector<int> str;
        set_id();
        print("Введите название кинотеатра:");
        push_line(name);
        print("Введите адрес кинотеатра:");
        push_line(address);
        print("Введите категорию кинотеатра:");
        push_line(category);
        print("Введите кол-во мест:");
        r_cin(places);
        print("Введите кол-во залов:");
        r_cin(halls);
        print("Введите 1, если кинотеатр работает, 0 если нет:");
        r_cin(i);
        state = (i == 1);
        print("Введите ID репертуаров через Enter или -1 для выхода:");
        push_vector(reps);
        print("Успех");
    }

    void find()
    {
        vector<Cinema> _cinemas;
        if (id)
        {
            for (Cinema a : cinemas)
            {
                if (id == a.id)
                {
                    if (!binary_search(_cinemas.begin(), _cinemas.end(), a))
                    {
                        a.show();
                    }
                    else
                        _cinemas.push_back(a);
                }
            }
            cc();
        }
        if (places)
        {
            for (Cinema a : cinemas)
            {
                if (places == a.places)
                {
                    if (!binary_search(_cinemas.begin(), _cinemas.end(), a))
                    {
                        a.show();
                    }
                    else
                        _cinemas.push_back(a);
                }
            }
        }
        if (halls)
        {
            for (Cinema a : cinemas)
            {
                if (halls == a.halls)
                {
                    if (!binary_search(_cinemas.begin(), _cinemas.end(), a))
                    {
                        a.show();
                    }
                    else
                        _cinemas.push_back(a);
                }
            }
        }
        if (state)
        {
            for (Cinema a : cinemas)
            {
                if (state == a.state)
                {
                    if (!binary_search(_cinemas.begin(), _cinemas.end(), a))
                    {
                        a.show();
                    }
                    else
                        _cinemas.push_back(a);
                }
            }
        }
        if (!name.empty())
        {
            for (Cinema a : cinemas)
            {
                if (name == a.name)
                {
                    if (!binary_search(_cinemas.begin(), _cinemas.end(), a))
                    {
                        a.show();
                    }
                    else
                        _cinemas.push_back(a);
                }
            }
        }
        if (!address.empty())
        {
            for (Cinema a : cinemas)
            {
                if (address == a.address)
                {
                    if (!binary_search(_cinemas.begin(), _cinemas.end(), a))
                    {
                        a.show();
                    }
                    else
                        _cinemas.push_back(a);
                }
            }
        }
        if (!category.empty())
        {
            for (Cinema a : cinemas)
            {
                if (category == a.category)
                {
                    if (!binary_search(_cinemas.begin(), _cinemas.end(), a))
                    {
                        a.show();
                    }
                    else
                        _cinemas.push_back(a);
                }
            }
        }
        if (!reps.empty())
        {
            for (Cinema a : cinemas)
            {
                if (reps == a.reps)
                {
                    if (!binary_search(_cinemas.begin(), _cinemas.end(), a))
                    {
                        a.show();
                    }
                    else
                        _cinemas.push_back(a);
                }
            }
        }
        _cinemas.clear();
        print("Введите для продолжения:");

        getchar();
        cls();
    }

    void show()
    {

        //<id><places><halls><name><address><category><state><reps[0] reps[n] >
        cout << "ID : " << id << ". Название : " << name << ". Адрес : " << address
             << ". Категория : " << category << ".\n Кол-во мест : " << places
             << ". Кол-во залов : " << halls
             << ". Состояние : " << ((state) ? ("Работает") : ("Не Работает \n Репертуары :\n"));
        for (Repertoire *&a : reps)
            a->show();
    }

    void save()
    {
        ofstream out("data/cinemas.db", ios::app);
        if (out.is_open())
        {
            out << "<" << id << "><" << places << "><" << halls << "><" << address
                << "><" << category << "><" << state << "><";
            for (Repertoire *&a : reps)
            {
                out << a->id << " ";
            }
            out << ">" << endl;
        }
        out.close();
        print("Кинотеатр сохранен");
    }

    bool operator<(const Cinema &a) const
    {
        // cout <<"\t"<< this->id<<"_"<<a.id<<"\n_______"<< ((this->id == a.id) && (this->name == a.name) && (this->studio == a.studio) &&
        //     (this->producers == a.producers) && (this->opers == a.opers) &&
        //(this->genres == a.genres) && (this->actors == a.actors)) <<endl;
        if ((this->id == a.id) && (this->name == a.name) && (this->halls == a.halls) &&
            (this->places == a.places) && (this->state == a.state) &&
            (this->address == a.address) && (this->category == a.category) && (this->reps == a.reps))
            return false;
        return true;
    }
};

Cinema::Cinema(int id, int places, int halls, string name,
               string address, string category, bool state, vector<Repertoire *> reps) : id(id), places(places), halls(halls), name(name),
                                                                                         address(address), category(category), state(state), reps(reps)
{
}

Cinema::~Cinema()
{
}

class Film
{
private:
    // int id;
    // string name, producer, oper, genre, studio;
    // vector<string> actors;

    // Сруктура файла .db:
    // id <name> <studio> <producers> <opers> <genres> <actors>
    // <.. , .. , ..>
public:
    int id;
    string name, studio;
    vector<string> producers;
    vector<string> opers;
    vector<string> genres;
    vector<string> actors;
    //Film *
    Film(string str);
    Film();
    Film(int a);
    Film(Film const &a);
    Film(int id, string name, string studio,
         vector<string> producers, vector<string> opers,
         vector<string> genres, vector<string> actors);
    ~Film();

    //123467
    //10
    void set_id()
    {
        id = 1;
        bool z = false;
        // vector<Film> films;
        // get_films(films);
        // vector<int> ids(films.size());
        for (;;)
        {
            z = false;
            for (Film const &a : films)
                if (id == a.id)
                {
                    z = true;
                    id++;
                    continue;
                }
            if (!z)
                return;
        }
    }
    void input()
    {
        set_id();
        print("Введите название:");
        push_line(name);
        print("Введите название киностудии");
        push_line(studio);
        print("Введите продюсеров через Enter (-1 для прекращения ввода)");
        push_vector(producers);
        print("Введите операторов через Enter (-1 для прекращения ввода)");
        push_vector(opers);
        print("Введите жанры ерез Enter (-1 для прекращения ввода)");
        push_vector(genres);
        print("Введите актеров ерез Enter (-1 для прекращения ввода)");
        push_vector(actors);
        print("Успех");
    }

    Film *search(int &j)
    {

        for (Film &a : films)
        {
            if (j == a.id)
            {
                return &a;
                a.show(); //ZAMZAMZAM
                          // return true;
                // print("Введите для продолжения:");
                // cc();
                // getchar();
                // cls();
            }
        }
        return 0;
    }

    void find()
    {
        // vector<Film> films;
        vector<Film> _films;
        // get_films(films);
        // cout << -1114213;

        if (id)
        {
            for (Film a : films)
            {
                if (id == a.id)
                {
                    if (!binary_search(_films.begin(), _films.end(), a))
                    {
                        a.show();
                    }
                    else
                        _films.push_back(a);
                }
            }
            cc();
        }
        if (!name.empty())
        {
            for (Film a : films)
            {
                if (low(name) == low(a.name))
                {
                    if (!binary_search(_films.begin(), _films.end(), a))
                    {
                        a.show();
                    }
                    else
                        _films.push_back(a);
                }
            }
        }
        if (!studio.empty())
        {
            for (Film a : films)
            {
                if (low(studio) == low(a.studio))
                {
                    if (!binary_search(_films.begin(), _films.end(), a))
                    {
                        a.show();
                    }
                    else
                        _films.push_back(a);
                }
            }
        }
        if (!producers.empty())
        {
            for (Film a : films)
            {
                for (string &x : producers)
                {
                    for (string &y : a.producers)
                    {
                        // cout << low(x) << "==" << low(y) << endl;
                        if (low(x) == low(y))
                        {
                            if (!binary_search(_films.begin(), _films.end(), a))
                            {
                                a.show();
                                _films.push_back(a);
                            }
                        }
                    }
                }
            }
        }
        if (!opers.empty())
        {
            for (Film a : films)
            {
                for (string &x : opers)
                {
                    for (string &y : a.opers)
                    {
                        // cout << low(x) << "==" << low(y) << endl;
                        if (low(x) == low(y))
                        {
                            if (!binary_search(_films.begin(), _films.end(), a))
                            {
                                a.show();
                                _films.push_back(a);
                            }
                        }
                    }
                }
            }
        }
        if (!genres.empty())
        {
            for (Film a : films)
            {
                for (string &x : genres)
                {
                    for (string &y : a.genres)
                    {
                        if (low(x) == low(y))
                        {
                            if (!(binary_search(_films.begin(), _films.end(), a)))
                            {
                                a.show();
                                _films.push_back(a);
                            }
                        }
                    }
                }
            }
        }
        if (!actors.empty())
        {
            for (Film a : films)
            {
                for (string &x : actors)
                {
                    for (string &y : a.actors)
                    {
                        if (low(x) == low(y))
                        {
                            if (!binary_search(_films.begin(), _films.end(), a))
                            {
                                a.show();
                                _films.push_back(a);
                            }
                        }
                    }
                }
            }
        }
        _films.clear();
        print("Введите для продолжения:");

        getchar();
        cls();
    }

    void show()
    {
        cout << "ID : " << id << ". Название : " << name << ". Жанр(ы) : " << unvector(genres)
             << ". Студия : " << studio << ".\nПродюссер(ы) : " << unvector(producers)
             << ". Оператор(ы) : " << unvector(opers)
             << ".\nАктер(ы) : " << unvector(actors) << endl
             << endl;
    }

    void save()
    {
        ofstream out("data/films.db", ios::app);
        if (out.is_open())
        {
            out << id << str(name) << str(studio) << str(producers)
                << str(opers) << str(genres) << str(actors) << endl;
        }
        out.close();
        print("Фильм сохранен");
    }

    bool operator<(const Film &a) const
    {
        // cout <<"\t"<< this->id<<"_"<<a.id<<"\n_______"<< ((this->id == a.id) && (this->name == a.name) && (this->studio == a.studio) &&
        //     (this->producers == a.producers) && (this->opers == a.opers) &&
        //(this->genres == a.genres) && (this->actors == a.actors)) <<endl;
        if ((this->id == a.id) && (this->name == a.name) && (this->studio == a.studio) &&
            (this->producers == a.producers) && (this->opers == a.opers) &&
            (this->genres == a.genres) && (this->actors == a.actors))
            return false;
        return true;
    }
};

Film::Film(Film const &a) : id(a.id), name(a.name), studio(a.studio), producers(a.producers),
                            opers(a.opers), genres(a.genres), actors(a.actors)
{
    // print("Использован КОНСТУРКТОР ПОКПИРОВАНИЯ");
}
Film::Film(string str)
{
    regex reg("\\d+");
    sregex_iterator abc(str.begin(),
                        str.end(), reg);
    vector<string> a;
    reg = ("(<.*?>)");
    a = parsing(str, reg);
    reg = ("'.*?'");

    *this = Film(stoi(smatch(*abc).str()), a[0], a[1], parsing(a[2], reg), parsing(a[3], reg),
                 parsing(a[4], reg), parsing(a[5], reg));
}
Film::Film() { input(); }
Film::Film(int a) {}
Film::Film(int id, string name, string studio,
           vector<string> producers, vector<string> opers,
           vector<string> genres, vector<string> actors) : id(id), name(name), studio(studio), producers(producers),
                                                           opers(opers), genres(genres), actors(actors)
{
    //  print("Конуструктор создания фильма был сипользован!\n");
}

Film::~Film()
{
}

class Repertoire
{
private:
    // int id, price, free_places;
    // string date;
    // Film *film;

public:
    int id, price, free_places;
    string date; //01.07.2021
    Film *film;
    Repertoire(int id, int price, int free_places,
               string date, Film *film);
    Repertoire(Repertoire const &a) : Repertoire(a.id, a.price, a.free_places, a.date, a.film) {}
    Repertoire(int a) {}
    Repertoire() { input(); }
    Repertoire(string str)
    {
        regex reg("\\w+");
        // sregex_iterator abc(str.begin(),
        //                     str.end(), reg);
        vector<string> a;
        a = parsing(str, reg);
        int d = stoi(a[1]);
        *this = Repertoire(stoi(a[0]), stoi(a[2]), stoi(a[3]), a[4], film->search(d));
    }

    Repertoire *search(int &j)
    {

        for (Repertoire &a : repertoires)
        {
            if (j == a.id)
            {
                return &a;
                a.show(); //ZAMZAMZAM
                          // return true;
                // print("Введите для продолжения:");
                // cc();
                // getchar();
                // cls();
            }
        }
        return 0;
    }

    void set_id()
    {
        id = 1;
        bool z = false;
        // vector<Film> films;
        // get_films(films);
        // vector<int> ids(films.size());
        for (;;)
        {
            z = false;
            for (Repertoire const &a : repertoires)
                if (id == a.id)
                {
                    z = true;
                    id++;
                    continue;
                }
            if (!z)
                return;
        }
    }
    void input()
    {
        int i;
        set_id();
        print("Введите дату:");
        push_line(date);
        print("Введите ID фильма");
        r_cin(i);
        film = film->search(i);
        print("Введите цену билета");
        r_cin(price);
        print("Введите кол-во свободных мест");
        r_cin(free_places);

        print("Успех");
        cc;
        print("Введите для продолжения:");

        getchar();
        cls();
    }

    void find()
    {
        // vector<Film> films;
        vector<Repertoire> _reps;
        // get_films(films);
        // cout << -1114213;

        if (id)
        {
            for (Repertoire a : repertoires)
            {
                if (id == a.id)
                {
                    if (!binary_search(_reps.begin(), _reps.end(), a))
                    {
                        a.show();
                    }
                    else
                        _reps.push_back(a);
                }
            }
            cc();
        }
        if (price)
        {
            for (Repertoire a : repertoires)
            {
                if (price == a.price)
                {
                    if (!binary_search(_reps.begin(), _reps.end(), a))
                    {
                        a.show();
                    }
                    else
                        _reps.push_back(a);
                }
            }
            cc();
        }
        if (free_places)
        {
            for (Repertoire a : repertoires)
            {
                if (free_places == a.free_places)
                {
                    if (!binary_search(_reps.begin(), _reps.end(), a))
                    {
                        a.show();
                    }
                    else
                        _reps.push_back(a);
                }
            }
            cc();
        }
        if (!date.empty())
        {
            for (Repertoire a : repertoires)
            {
                if (date == a.date)
                {
                    if (!binary_search(_reps.begin(), _reps.end(), a))
                    {
                        a.show();
                    }
                    else
                        _reps.push_back(a);
                }
            }
            cc();
        }
        if (!date.empty())
        {
            for (Repertoire a : repertoires)
            {
                if (film == a.film)
                {
                    if (!binary_search(_reps.begin(), _reps.end(), a))
                    {
                        a.show();
                    }
                    else
                        _reps.push_back(a);
                }
            }
            cc();
        }
        _reps.clear();
        print("Введите для продолжения:");

        getchar();
        cls();
    }
    //id id_film price free_place date
    void save()
    {
        ofstream out("data/pertoires.db", ios::app);
        if (out.is_open())
        {
            out << id << " " << film->id << " " << price << " "
                << free_places << " " << date << " ";
        }
        out.close();
        print("Репертуар сохранен");
    }

    void show()
    {
        cout << "ID : " << id << ". Дата : " << d(date) << ". Цена : " << price
             << ".\n Кол-во свободных мест: : " << free_places << ". Фильм : " << endl;
        film->show();
    }

    bool operator<(const Repertoire &a) const
    {
        // cout <<"\t"<< this->id<<"_"<<a.id<<"\n_______"<< ((this->id == a.id) && (this->name == a.name) && (this->studio == a.studio) &&
        //     (this->producers == a.producers) && (this->opers == a.opers) &&
        //(this->genres == a.genres) && (this->actors == a.actors)) <<endl;
        if ((this->id == a.id) && (this->date == a.date) && (this->film == a.film) &&
            (this->free_places == a.free_places) && (this->price == a.price))
            return false;
        return true;
    }

    ~Repertoire();
};

Repertoire::Repertoire(int id, int price, int free_places,
                       string date, Film *film) : id(id), price(price),
                                                  free_places(free_places), date(date), film(film)
{
}

Repertoire::~Repertoire()
{
}

void get_films()
{
    films.clear();
    string line;
    ifstream in("data/films.db"); // окрываем файл для чтения
    if (in.is_open())
    {
        while (getline(in, line))
        {
            //cout << line << endl;
            films.push_back(Film(line));
        }
    }
}
void get_repertoires()
{
    repertoires.clear();
    string line;
    ifstream in("data/repertoires.db"); // окрываем файл для чтения
    if (in.is_open())
    {
        while (getline(in, line))
        {
            //cout << line << endl;
            repertoires.push_back(Repertoire(line));
        }
    }
}
void get_cinemas()
{
    cinemas.clear();
    string line;
    ifstream in("data/cinemas.db"); // окрываем файл для чтения
    if (in.is_open())
    {
        while (getline(in, line))
        {
            //cout << line << endl;
            cinemas.push_back(Cinema(line));
        }
    }
}
void get_all(/*vector<Cinema> &cinemas, vector<Film> &films, vector<Repertoire> &repertoires*/) //выгрузка данных
{
    get_films();
    get_repertoires();
    get_cinemas();
    print("Соединение проозшоло успешно");
}
void set_all(/*vector<Cinema> &cinemas, vector<Film> &films, vector<Repertoire> &repertoires*/) //сохранение данных
{
    ofstream out;              // поток для записи
    out.open("data/films.db"); // окрываем файл для записи
    out.close();
    out.open("data/films.db");

    if (out.is_open())
    {
        for (Film &a : films)
        {
            a.save();
        }
        out.close();
    }
    out.open("data/repertoires.db"); // окрываем файл для записи
    out.close();
    out.open("data/repertoires.db");

    if (out.is_open())
    {
        for (Repertoire &a : repertoires)
        {
            a.save();
        }
        out.close();
    }
    out.open("data/cinemas.db"); // окрываем файл для записи
    out.close();
    out.open("data/cinemas.db");

    if (out.is_open())
    {
        for (Cinema &a : cinemas)
        {
            a.save();
        }
        out.close();
    }
    print("Соединение проозшоло успешно");
}

int main()
{
    std::mt19937 engine;
    engine.seed(std::time(nullptr));
    system("chcp 1251");
    cls();

    int x, y;

    get_all();

    for (;;)
    {
        print("Для СОХРАНЕНИЯ ИЗМЕНЕНИЙ выходите из программы с помощью меню!");
        cinx(y, "Выберите область, с которой вы будете работать:", 3, "Кинотеатры", "Фильмы", "Репертуары");

        switch (y)
        {
        case 1:
        {
            for (;;)
            {

                print("Нажата 1");
                cinx(x, "Выберите действие:", 4, "Отобразить текущие кинотеатры", "Отобразить сведения кинотеатра по ключу",
                     "Поиск кинотеатров", "Редактирование кинотеатров");
                switch (x)
                {
                case 1:
                {
                    print("Список текущих кинотетров:");
                    for (Cinema &a : cinemas)
                        a.show();
                    print("Введите для продолжения");
                    getchar();
                    cls();
                    break;
                }
                case 2:
                {
                    int j;
                    print("Введите ключ нужного вам кинотеатра или -1 для выхода");
                    r_cin(j);
                    if (j == -1)
                    {
                        cls();
                        break;
                    }
                    for (Cinema &a : cinemas)
                    {
                        if (j == a.id)
                        {
                            a.show();
                            print("Введите для продолжения:");
                            cc();
                            getchar();
                            cls();
                            j = -1;
                        }
                    }

                    if (j != -1)
                    {
                        print("Кинотеатра с данным ключом не существует");
                        print("Введите для продолжения:");
                        cc();
                        getchar();
                        cls();
                    }
                    break;
                }
                case 3:
                {
                    int j, i;
                    string b;
                    Cinema a(0);

                    cinx(j, "Выберите свойство, которое вы введете, и по которому будет происходить поиск:",
                         8, "ID", "Название кинотеатра", "Кол-во залов", "Кол-во мест", "Адрес",
                         "Категория", "Состояние", "ID репертуаров");
                    if (j == 0)
                    {
                        cls();
                        break;
                    }

                    if (j == 1)
                    {
                        print("Введите ID:");
                        r_cin(a.id);
                    }

                    if (j == 2)
                    {

                        print("Введите название кинотеатра:");

                        push_line(a.name);
                    }

                    if (j == 3)
                    {
                        print("Введите кол-во залов:");
                        r_cin(a.halls);
                    }

                    if (j == 4)
                    {
                        print("Введите кол-во мест");
                        r_cin(a.places);
                    }
                    if (j == 5)
                    {
                        print("Введите адрес:");
                        push_line(a.address);
                    }
                    if (j == 6)
                    {
                        print("Введите категорию:");
                        push_line(a.category);
                    }
                    if (j == 7)
                    {
                        print("Введите состояние:");
                        r_cin(i);
                        a.state = (i == 1);
                    }
                    if (j == 8)
                    {
                        print("Введите ID репертуаров через Enter или -1 для выхода:");
                        push_vector(a.reps);
                    }
                    cout << endl;
                    a.find();
                    
                    break;
                }

                case 4:
                {
                    print("Нажата 4");
                    cinx(x, "Выберите действие:", 3, "Добавить кинотеатр", "Удалить кинотеатр", "Изменить кинотеатр");

                    switch (x)
                    {
                    case 1:
                    {
                        print("1) добавить фильм");
                        Film a;
                        a.input();
                        a.save();
                        print("добавлен");
                        break;
                    }
                    default:
                        break;
                    }

                    break;
                }
                default:
                {
                    //cout << -12356889;
                    break;
                }
                }
                if (!x)
                    break;
            }
            break;
        }
        case 2:
        {
            for (;;)
            {
                cinx(x, "Выберите действие:", 4, "Отобразить текущие фильмы", "Отобразить сведения фильма по ключу",
                     "Поиск фильма", "Редактирование фильмов");
                switch (x)
                {
                case 1:
                {
                    print("Список текущих фильмов:");
                    for (Film &a : films)
                        a.show();
                    //cout << "ID : " << a.id << ". Название : " << a.name << ". Жанр : " << unvector(a.genres) << "." << endl;
                    print("Введите для продолжения");
                    getchar();
                    cls();
                    break;
                }
                case 2:
                {
                    int j;
                    print("Введите ключ нужного вам фильма или -1 для выхода");
                    r_cin(j);
                    if (j == -1)
                    {
                        cls();
                        break;
                    }
                    for (Film &a : films)
                    {
                        if (j == a.id)
                        {
                            a.show();
                            print("Введите для продолжения:");
                            cc();
                            getchar();
                            cls();
                            j = -1;
                        }
                    }

                    if (j != -1)
                    {
                        print("Фильма с данным ключом не существует");
                        print("Введите для продолжения:");
                        cc();
                        getchar();
                        cls();
                    }
                    break;
                    //case 4:
                    // print("Нажата 4");
                    // cinx(x, "Выберите действие:", 3, "Добавить фильм", "Удалить фильм", "Изменить фильм");
                }
                case 3:
                {
                    int j;
                    string b;
                    Film a(0);

                    cinx(j, "Выберите свойство, которое вы введете, и по которому будет происходить поиск:",
                         7, "ID",
                         "Название фильма", "Название студии", "Продюсеры", "Операторы", "Жанры", "Актеры");

                    // getline(cin, j);
                    // while ((ctoi(j) < 0) || (ctoi(j) > 7)) //|| ((j[1] != ' ') && (j[0] != '7')))
                    // {
                    //     cout << "Неверное значение (введите цифру от 1 до " << 7 << ")" << endl;
                    //     getline(cin, j);
                    // }
                    // cout << j << endl
                    //      << "\t" << ctoi(j) << endl;
                    if (j == 0)
                    {
                        cls();
                        break;
                    }

                    if (j == 1)
                    {
                        print("Введите ID:");
                        cin >> a.id;
                    }

                    if (j == 2)
                    {
                        print("Введите Название фильма:");
                        getline(cin, a.name);
                    }

                    if (j == 3)
                    {
                        print("Введите Название студии:");
                        getline(cin, a.studio);
                    }

                    if (j == 4)
                    {
                        print("Введите продюсеров через запятую:");
                        getline(cin, b);

                        a.producers = (e_parse(b));
                    }
                    if (j == 5)
                    {
                        print("Введите операторов через запятую:");
                        getline(cin, b);
                        a.opers = (e_parse(b));
                    }
                    if (j == 6)
                    {
                        print("Введите жанры через запятую:");
                        getline(cin, b);
                        a.genres = (e_parse(b));
                    }
                    if (j == 7)
                    {
                        print("Введите актеров через запятую:");
                        getline(cin, b);
                        a.actors = (e_parse(b));
                    }
                    cout << endl;
                    a.find();

                    break;
                }

                case 4:
                {
                    print("Нажата 4");
                    cinx(x, "Выберите действие:", 3, "Добавить фильм", "Удалить фильм", "Изменить фильм");

                    switch (x)
                    {
                    case 1:
                    {

                        films.push_back(Film());
                        //films[films.size() - 1].save(); //
                        print("Успешно добавлен");
                        print("Введите для продолжения:");
                        getchar();
                        cls();
                        break;
                    }
                    case 2:
                    {
                        for (;;)
                        {
                            int j;
                            int x = rand(10);
                            cinx(j, "Введите ключ фильма, который вы хотите удалить или -1 для выхода:");
                            if (j == -1)
                                cls();
                            break;

                            for (auto it = films.begin(); it < films.end(); it++)
                            {
                                if ((*it).id == j)
                                {

                                    print("Фильм который вы хотите удалить:");
                                    (*it).show();
                                    cout << "Для подтверждения удаления введите " << x << " :";
                                    cinx(j, "");
                                    if (j == x)
                                    {
                                        films.erase(it);
                                        print("Успех");
                                        j = -1337;
                                    }
                                    else
                                    {
                                        print("Отмена");
                                        j = -1337;
                                    }
                                    break;
                                }
                            }
                            if (j != -1337)
                            {
                                print("Фильм не был найден");
                            }
                        }

                        break;
                    }
                    case 3:
                    {
                        int j;
                        int x;
                        cinx(j, "Введите ID фильма, который нужно изменить:");
                        for (size_t i = 0; i < films.size(); i++)
                        {
                            {
                                if (films[i].id == j)
                                {
                                    print("Фильм который вы хотите изменить:");
                                    films[i].show();
                                    for (;;)
                                    {
                                        cinx(x, "Выберите свойства для его замены:", 6, "Название фильма",
                                             "Название студии", "Продюсеры", "Операторы", "Жанры", "Актеры");
                                        if (x == 0)
                                            break;
                                        if (x == 1)
                                        {
                                            print("Введите название:");
                                            films[i].name.clear();
                                            push_line(films[i].name);
                                        }
                                        if (x == 2)
                                        {
                                            print("Введите название киностудии");
                                            films[i].studio.clear();
                                            push_line(films[i].studio);
                                        }
                                        if (x == 3)
                                        {
                                            print("Введите продюсеров через Enter (-1 для прекращения ввода)");
                                            films[i].producers.clear();
                                            push_vector(films[i].producers);
                                        }
                                        if (x == 4)
                                        {
                                            print("Введите операторов через Enter (-1 для прекращения ввода)");
                                            films[i].opers.clear();
                                            push_vector(films[i].opers);
                                        }
                                        if (x == 5)
                                        {
                                            print("Введите жанры ерез Enter (-1 для прекращения ввода)");
                                            films[i].genres.clear();
                                            push_vector(films[i].genres);
                                        }
                                        if (x == 6)
                                        {
                                            print("Введите актеров ерез Enter (-1 для прекращения ввода)");
                                            films[i].actors.clear();
                                            push_vector(films[i].actors);
                                        }
                                        print("Успех");
                                    }
                                    print("Измененный фильм:");
                                    films[i].show();
                                    cc();
                                    print("Введите для продолжения");
                                    getchar();
                                    cls();
                                    break;
                                }
                            }
                        }
                    }
                    default:
                        break;
                    }

                    break;
                }
                default:
                {
                    break;
                }
                }
                if (!x)
                    break;
            }
            break;
        }
        case 3:
            for (;;)
            {
                cinx(x, "Выберите действие:", 4, "Отобразить текущие репертуары", "Отобразить сведения репертуара по ключу",
                     "Поиск репертуара", "Редактирование репертуаров");
                switch (x)
                {
                case 1:
                {
                    print("Список текущих репертуаров:");
                    for (Repertoire &a : repertoires)
                        a.show();
                    //cout << "ID : " << a.id << ". Название : " << a.name << ". Жанр : " << unvector(a.genres) << "." << endl;
                    print("Введите для продолжения");
                    getchar();
                    cls();
                    break;
                }
                case 2:
                {
                    int j;
                    print("Введите ключ нужного вам репертуара или -1 для выхода");
                    r_cin(j);
                    if (j == -1)
                    {
                        cls();
                        break;
                    }
                    for (Repertoire &a : repertoires)
                    {
                        if (j == a.id)
                        {
                            a.show();
                            print("Введите для продолжения:");
                            cc();
                            getchar();
                            cls();
                            j = -1;
                        }
                    }

                    if (j != -1)
                    {
                        print("Репертуара с данным ключом не существует");
                        print("Введите для продолжения:");
                        cc();
                        getchar();
                        cls();
                    }
                    break;
                }
                case 3:
                {
                    int j, i;
                    string b;
                    Repertoire a(0);

                    cinx(j, "Выберите свойство, которое вы введете, и по которому будет происходить поиск:",
                         5, "ID",
                         "ID фильма", "Дата", "Цена", "Свободные места");

                    // getline(cin, j);
                    // while ((ctoi(j) < 0) || (ctoi(j) > 7)) //|| ((j[1] != ' ') && (j[0] != '7')))
                    // {
                    //     cout << "Неверное значение (введите цифру от 1 до " << 7 << ")" << endl;
                    //     getline(cin, j);
                    // }
                    // cout << j << endl
                    //      << "\t" << ctoi(j) << endl;
                    if (j == 0)
                    {
                        cls();
                        break;
                    }

                    if (j == 1)
                    {
                        print("Введите ID:");
                        cin >> a.id;
                    }

                    if (j == 2)
                    {

                        print("Введите ID фильма:");

                        r_cin(i);
                        a.film = a.film->search(i);
                    }

                    if (j == 3)
                    {
                        print("Введите дату в формате ДДММГГ (например, 30052021):");
                        getline(cin, a.date);
                    }

                    if (j == 4)
                    {
                        print("Введите цену");
                        r_cin(i);

                        a.price = i;
                    }
                    if (j == 5)
                    {
                        print("Введите количество свободных мест:");
                        r_cin(i);

                        a.free_places = i;
                    }
                    cout << endl;
                    a.find();

                    break;
                }

                case 4:
                {
                    print("Нажата 4");
                    cinx(x, "Выберите действие:", 3, "Добавить реперутар", "Удалить реперутар", "Изменить реперутар");

                    switch (x)
                    {
                    case 1:
                    {

                        repertoires.push_back(Repertoire());
                        //films[films.size() - 1].save(); //
                        print("Успешно добавлен");
                        print("Введите для продолжения:");
                        getchar();
                        cls();
                        break;
                    }
                    case 2:
                    {
                        for (;;)
                        {
                            int j;
                            int x = rand(10);
                            cinx(j, "Введите ключ репертуара, который вы хотите удалить или -1 для выхода:");
                            if (j == -1)
                                cls();
                            break;

                            for (auto it = repertoires.begin(); it < repertoires.end(); it++)
                            {
                                if ((*it).id == j)
                                {

                                    print("Репертуар который вы хотите удалить:");
                                    (*it).show();
                                    cout << "Для подтверждения удаления введите " << x << " :";
                                    cinx(j, "");
                                    if (j == x)
                                    {
                                        repertoires.erase(it);
                                        print("Успех");
                                        j = -1337;
                                    }
                                    else
                                    {
                                        print("Отмена");
                                        j = -1337;
                                    }
                                    break;
                                }
                            }
                            if (j != -1337)
                            {
                                print("Репертуар не был найден");
                            }
                        }

                        break;
                    }
                    case 3:
                    {
                        int j;
                        int x;
                        cinx(j, "Введите ID репертуара, который нужно изменить:");
                        for (size_t i = 0; i < repertoires.size(); i++)
                        {
                            {
                                if (repertoires[i].id == j)
                                {
                                    print("Репертуар который вы хотите изменить:");
                                    repertoires[i].show();
                                    for (;;)
                                    {
                                        cinx(x, "Выберите свойства для его замены:", 4, "Дата",
                                             "ID фильма", "Цена", "Кол-во свободных мест");
                                        if (x == 0)
                                            break;
                                        if (x == 1)
                                        {
                                            print("Введите дату:");
                                            repertoires[i].date.clear();
                                            push_line(repertoires[i].date);
                                        }
                                        if (x == 2)
                                        {
                                            print("Введите ID фильма");
                                            r_cin(j);
                                            repertoires[i].film = repertoires[i].film->search(j);
                                        }
                                        if (x == 3)
                                        {
                                            print("Введите цену");
                                            r_cin(repertoires[i].price);
                                        }
                                        if (x == 4)
                                        {
                                            print("Введите кол-во свободных мест");
                                            r_cin(repertoires[i].free_places);
                                        }

                                        print("Успех");
                                    }
                                    print("Измененный репертуар:");
                                    films[i].show();
                                    cc();
                                    print("Введите для продолжения");
                                    getchar();
                                    cls();
                                    break;
                                }
                            }
                        }
                    }
                    default:
                        break;
                    }

                    break;
                }
                default:
                {
                    // cout << -12356889;
                    break;
                }
                }
                if (!x)
                    break;
            }
            break;
        default:
            set_all();
            return 0;
        }
    }
}
